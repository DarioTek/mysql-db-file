use financedb;

/*
 * All Transaction History for each of the 4 accounts
 */
SELECT 
	*
FROM
	LOAD_TRANSACTION_HISTORY;


SELECT
	*
FROM
	LOAD_TRANSACTION_HISTORY
ORDER BY
	RECORD_DATE DESC;

# 'Dario 1', '2024-09-20', 'Sell to Open', 'NFLX 10/18/2024 600.00 P', 'PUT NETFLIX INC $600 EXP 10/18/24', '1', '4.54', '0.67', '453.33'
# 'Dario 1', '2024-09-20', 'Buy to Open', 'NFLX 10/18/2024 575.00 P', 'PUT NETFLIX INC $575 EXP 10/18/24', '1', '2.67', '0.66', '-267.66'

/*
 * Select from the TRANSACTIONS_VIEW tablse
 */
SELECT
	*
FROM
	TRANSACTIONS_VIEW
ORDER BY
	RECORD_TIME DESC;

SELECT
	*
FROM
	TRANSACTIONS_VIEW
WHERE 
	INSTRUMENT_DESCRIPTION in ('NETFLIX INC 10/18/2024 $600 Put','NETFLIX INC 10/18/2024 $575 Put')
ORDER BY
	RECORD_TIME DESC;



/*
 * Sample Option Positions that got Assigned
 */
SELECT 
	*
FROM
	LOAD_TRANSACTION_HISTORY
WHERE
    ACTION = 'Assigned'
;

/*
 * Unique Actions
 */
SELECT 
	DISTINCT(ACTION)
FROM
	LOAD_TRANSACTION_HISTORY;



/*
 * Number of transactions for 2024 
 */
SELECT 
	SOURCE,
    COUNT(SOURCE)
FROM
	LOAD_TRANSACTION_HISTORY
WHERE
	RECORD_DATE >= '2024-01-01'
GROUP BY 
	SOURCE;

/*
 * Sample Vertical Put Spread that was closed
 */
SELECT 
	*
FROM
	LOAD_TRANSACTION_HISTORY
WHERE
	SYMBOL IN ('META 09/20/2024 450.00 P','META 09/20/2024 475.00 P')
;
    
SELECT 
	SUM(AMOUNT)
FROM
	LOAD_TRANSACTION_HISTORY
WHERE
	SYMBOL IN ('META 09/20/2024 450.00 P','META 09/20/2024 475.00 P')
;


/*
 * Sample Vertical Put Spread that was Expired
 */
SELECT 
	*
FROM
	LOAD_TRANSACTION_HISTORY
WHERE
	SYMBOL IN ('SPXW 09/16/2024 5300.00 P','SPXW 09/16/2024 5250.00 P')
;
    
SELECT 
	SUM(AMOUNT)
FROM
	LOAD_TRANSACTION_HISTORY
WHERE
	SYMBOL IN ('SPXW 09/16/2024 5300.00 P','SPXW 09/16/2024 5250.00 P')
;
 

/*
 * Sample Put Option Assigned at Expiration for SDIV
 */
SELECT 
	*
FROM
	LOAD_TRANSACTION_HISTORY
WHERE
	SYMBOL IN ('SDIV 06/21/2024 22.00 P') OR
    SYMBOL = 'SDIV' AND ACTION = 'Buy' AND RECORD_DATE = '2024/06/24' # Day after the expiration
;
 
SELECT 
	*
FROM
	LOAD_TRANSACTION_HISTORY
WHERE
	SOURCE = 'Dario 2' AND
	RECORD_DATE = '2024-06-24'
;
 


/*
 * Sample Put Option Assigned at Expiration for TSLA on 8/12/2024
 */ 
SELECT 
	*
FROM
	LOAD_TRANSACTION_HISTORY
WHERE
	SOURCE = 'Dario 1' AND
	RECORD_DATE = '2024-08-12' AND
    (SYMBOL = 'TSLA 08/09/2024 215.00 P' OR SYMBOL = 'TSLA')
UNION
SELECT 
	*
FROM
	LOAD_TRANSACTION_HISTORY
WHERE
    SYMBOL = 'TSLA 08/09/2024 215.00 P'
UNION
SELECT 
	*
FROM
	LOAD_TRANSACTION_HISTORY
WHERE
	RECORD_DATE = '2024-07-15' AND
    SYMBOL LIKE 'TSLA%'
UNION
SELECT 
	*
FROM
	LOAD_TRANSACTION_HISTORY
WHERE
    SYMBOL = 'TSLA 08/09/2024 200.00 P'
;

SELECT 
	*
FROM
	LOAD_TRANSACTION_HISTORY
WHERE
    SYMBOL = 'TSLA 08/09/2024 200.00 P'
;


