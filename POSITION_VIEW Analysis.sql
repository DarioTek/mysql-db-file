use financedb;

SELECT count(*) FROM POSITION_VIEW;

SELECT * FROM POSITION_VIEW;

/*
 * Select all relevant columns for analysis
 */
SELECT
	RECORD_DATE,
	ACCOUNT_DESCRIPTION,
	AVERAGE_PRICE,
    SHORT_QUANTITY,
	LONG_QUANTITY,
    ASSET_TYPE,
    SYMBOL, 
    POSITION_DESCRIPTION,
    NET_CHANGE,
    PUT_CALL,
    MARKET_VALUE,
    MAINTENANCE_REQUIREMENT,
    AVERAGE_SHORT_PRICE,
    AVERAGE_LONG_PRICE,
    OPEN_INTEREST,
    DAYS_TO_EXPIRATION,
    THEORETICAL_VOLATILITY,
    VOLATILIY,
    DELTA,
    GAMMA,
    THETA,
    RHO,
    VEGA
FROM 
	POSITION_VIEW
ORDER BY 
	DAYS_TO_EXPIRATION;
    
    
    
SELECT
	RECORD_DATE,
	ACCOUNT_DESCRIPTION,
	AVERAGE_PRICE,
    SHORT_QUANTITY,
	LONG_QUANTITY,
    ASSET_TYPE,
    SYMBOL, 
    POSITION_DESCRIPTION,
    NET_CHANGE,
    PUT_CALL,
    MARKET_VALUE,
    MAINTENANCE_REQUIREMENT,
    AVERAGE_SHORT_PRICE,
    AVERAGE_LONG_PRICE,
    OPEN_INTEREST,
    DAYS_TO_EXPIRATION,
    THEORETICAL_VOLATILITY,
    VOLATILIY,
    DELTA,
    GAMMA,
    THETA,
    RHO,
    VEGA
FROM 
	POSITION_VIEW
WHERE
	ASSET_TYPE = 'OPTION'
ORDER BY 
	DAYS_TO_EXPIRATION;
    
/*
 * pie_chart query
 */
SELECT 
	AR.ACCOUNT_DESCRIPTION,
	DB.ACCOUNT_NUMBER,
	DB.RECORD_DATE,
	DB.LIQUIDITY_VALUE
FROM 
	DAILY_BALANCE DB,
	ACCOUNT_REFERENCE AR
WHERE
	DB.ACCOUNT_NUMBER = AR.ACCOUNT_NUMBER AND
	DATE(RECORD_DATE) = (SELECT MAX(RECORD_DATE) FROM DAILY_BALANCE);
     
/*
 * option_position_piechart
 */
SELECT 
	UNDERLYING_SYMBOL,
	SUM(MAINTENANCE_REQUIREMENT) AS MAINTENANCE_REQUIREMENT
FROM 
	POSITION_VIEW
WHERE 
	ASSET_TYPE = 'OPTION' AND
	DATE(RECORD_DATE) = (SELECT MAX(RECORD_DATE) FROM POSITION)
GROUP BY
	UNDERLYING_SYMBOL;
